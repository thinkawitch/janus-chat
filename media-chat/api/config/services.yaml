# This file is the entry point to configure your own services.
# Files in the packages/ subdirectory configure your dependencies.

# Put parameters here that don't need to change on each machine where the app is deployed
# https://symfony.com/doc/current/best_practices.html#use-parameters-for-application-configuration
# https://symfony.com/doc/current/configuration/env_var_processors.html
parameters:
    app.janus_server_name: '%env(string:JANUS_SERVER_NAME)%'
    app.janus_api_url: '%env(string:JANUS_API_URL)%'
    app.janus_api_secret: '%env(string:JANUS_API_SECRET)%'
    app.janus_admin_url: '%env(string:JANUS_ADMIN_URL)%'
    app.janus_admin_secret: '%env(string:JANUS_ADMIN_SECRET)%'
    app.janus_textroom_admin_key: '%env(string:JANUS_TEXTROOM_ADMIN_KEY)%'
    app.janus_videoroom_admin_key: '%env(string:JANUS_VIDEOROOM_ADMIN_KEY)%'
    app.use_text_rooms: '%env(bool:USE_TEXT_ROOMS)%'
    app.use_video_rooms: '%env(bool:USE_VIDEO_ROOMS)%'

services:
    # default configuration for services in *this* file
    _defaults:
        autowire: true      # Automatically injects dependencies in your services.
        autoconfigure: true # Automatically registers your services as commands, event subscribers, etc.
        bind:
            $useTextRooms: '%app.use_text_rooms%'
            $useVideoRooms: '%app.use_video_rooms%' # JanusUserApiService RoomsController

    # to write to log original message, with new line chars
    monolog.multiline_formatter:
        class: Monolog\Formatter\LineFormatter
        arguments: [ ~, ~, true ]

    # makes classes in src/ available to be used as services
    # this creates a service per class whose id is the fully-qualified class name
    App\:
        resource: '../src/'
        exclude:
            - '../src/DependencyInjection/'
            - '../src/Entity/'
            - '../src/Kernel.php'

    # add more service definitions when explicit configuration is needed
    # please note that last definitions always *replace* previous ones
    Thinkawitch\JanusApi\JanusHttpAdminClient:
        arguments:
            $url: '%app.janus_admin_url%'
            $adminSecret: '%app.janus_admin_secret%'
    Thinkawitch\JanusApi\JanusHttpClient:
        arguments:
            $url: '%app.janus_api_url%'
            $apiSecret: '%app.janus_api_secret%'
    App\Service\JanusUserApiService:
        arguments:
            $textRoomAdminKey: '%app.janus_textroom_admin_key%'
            $videoRoomAdminKey: '%app.janus_videoroom_admin_key%'
